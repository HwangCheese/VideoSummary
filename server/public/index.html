<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ¥ í•˜ì´ë¼ì´íŠ¸ ìš”ì•½</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    #dropZone {
      width: 500px; height: 150px; border: 3px dashed #999;
      display: flex; justify-content: center; align-items: center;
      margin-bottom: 1rem; border-radius: 10px;
    }
    #dropZone.hover { background-color: #f0f0f0; }
    video { width: 600px; border-radius: 10px; margin-top: 1rem; }
  </style>
</head>
<body>

<h1>ğŸ“¥ ì˜ìƒ ì—…ë¡œë“œ ë° ìš”ì•½</h1>

<div id="dropZone">ì—¬ê¸°ë¡œ .mp4 íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
<button id="startBtn" disabled>ğŸš€ ìš”ì•½ ì‹œì‘</button>
<p id="status"></p>

<h2>ğŸ¬ ìµœì¢… ìš”ì•½ ì˜ìƒ</h2>
<video id="finalVideo" controls style="display:none;"></video>

<script>
let uploadedFileName = "";

const dropZone = document.getElementById("dropZone");
const startBtn = document.getElementById("startBtn");
const statusDiv = document.getElementById("status");

dropZone.addEventListener("dragover", e => {
  e.preventDefault();
  dropZone.classList.add("hover");
});
dropZone.addEventListener("dragleave", () => dropZone.classList.remove("hover"));

dropZone.addEventListener("drop", async e => {
  e.preventDefault();
  dropZone.classList.remove("hover");
  const file = e.dataTransfer.files[0];
  if (!file || !file.name.endsWith(".mp4")) return alert("âš ï¸ mp4 íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥!");

  const formData = new FormData();
  formData.append("video", file);

  statusDiv.textContent = "â« ì—…ë¡œë“œ ì¤‘...";
  const res = await fetch("/upload", { method: "POST", body: formData });
  const data = await res.json();
  if (res.ok) {
    uploadedFileName = data.filename;
    statusDiv.textContent = `âœ… ì—…ë¡œë“œ ì™„ë£Œ: ${uploadedFileName}`;
    startBtn.disabled = false;
  } else {
    statusDiv.textContent = "âŒ ì—…ë¡œë“œ ì‹¤íŒ¨";
  }
});

startBtn.addEventListener("click", async () => {
  if (!uploadedFileName) return;
  statusDiv.textContent = "ğŸ§  ìš”ì•½ ì¤‘...";

  const res = await fetch(`/upload/process?filename=${uploadedFileName}`);
  const data = await res.json();
  if (res.ok) {
    statusDiv.textContent = "âœ… ìš”ì•½ ì™„ë£Œ!";
    const finalVideo = document.getElementById("finalVideo");
    finalVideo.src = "/results/final_highlight.mp4";
    finalVideo.style.display = "block";
  } else {
    statusDiv.textContent = "âŒ ìš”ì•½ ì‹¤íŒ¨!";
  }
});
</script>

</body>
</html>
