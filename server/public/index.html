<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ¥ í•˜ì´ë¼ì´íŠ¸ ìš”ì•½</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      color: #333;
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    h1 {
      margin-bottom: 1rem;
    }

    #dropZone {
      width: 600px;
      height: 180px;
      border: 3px dashed #6c757d;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.2rem;
      color: #6c757d;
      transition: background-color 0.3s, border-color 0.3s;
      cursor: pointer;
      margin-bottom: 1rem;
    }

    #dropZone.hover {
      background-color: #e2e6ea;
      border-color: #495057;
      color: #495057;
    }

    button {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 0.7rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s;
    }

    button:disabled {
      background-color: #adb5bd;
      cursor: not-allowed;
    }

    button:not(:disabled):hover {
      background-color: #0056b3;
    }

    #status {
      margin-top: 1rem;
      font-weight: 500;
    }

    video {
      width: 700px;
      border-radius: 12px;
      margin-top: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    /* Loading spinner */
    .spinner {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #007bff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-top: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<h1>ğŸ¬ ë¹„ë””ì˜¤ í•˜ì´ë¼ì´íŠ¸ ìš”ì•½ ì„œë¹„ìŠ¤</h1>

<div id="dropZone">ğŸ“‚ .mp4 íŒŒì¼ì„ ì´ê³³ì— ë“œë˜ê·¸í•˜ì„¸ìš”</div>
<button id="startBtn" disabled>ğŸš€ í•˜ì´ë¼ì´íŠ¸ ìƒì„±</button>
<p id="status"></p>
<div id="loadingSpinner" class="spinner" style="display:none;"></div>

<h2>âœ¨ í•˜ì´ë¼ì´íŠ¸ ê²°ê³¼ ì˜ìƒ</h2>
<video id="finalVideo" controls style="display:none;"></video>

<script>
let uploadedFileName = "";

const dropZone = document.getElementById("dropZone");
const startBtn = document.getElementById("startBtn");
const statusDiv = document.getElementById("status");
const loadingSpinner = document.getElementById("loadingSpinner");

// ë“œë˜ê·¸ ì•¤ ë“œë¡­ íš¨ê³¼
['dragenter', 'dragover'].forEach(evt =>
  dropZone.addEventListener(evt, e => {
    e.preventDefault();
    dropZone.classList.add("hover");
  })
);

['dragleave', 'drop'].forEach(evt =>
  dropZone.addEventListener(evt, e => {
    e.preventDefault();
    dropZone.classList.remove("hover");
  })
);

// íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
dropZone.addEventListener("drop", async e => {
  const file = e.dataTransfer.files[0];
  if (!file || !file.name.endsWith(".mp4")) return alert("âš ï¸ mp4 íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");

  const formData = new FormData();
  formData.append("video", file);

  statusDiv.textContent = "â³ ì—…ë¡œë“œ ì¤‘...";
  loadingSpinner.style.display = "block";

  const res = await fetch("/upload", { method: "POST", body: formData });
  const data = await res.json();
  loadingSpinner.style.display = "none";

  if (res.ok) {
    uploadedFileName = data.filename;
    statusDiv.textContent = `âœ… ì—…ë¡œë“œ ì„±ê³µ: ${uploadedFileName}`;
    startBtn.disabled = false;
  } else {
    statusDiv.textContent = "âŒ ì—…ë¡œë“œ ì‹¤íŒ¨";
  }
});

// í•˜ì´ë¼ì´íŠ¸ ìƒì„±
startBtn.addEventListener("click", async () => {
  if (!uploadedFileName) return;

  statusDiv.textContent = "ğŸ§  í•˜ì´ë¼ì´íŠ¸ ìƒì„± ì¤‘...";
  loadingSpinner.style.display = "block";
  startBtn.disabled = true;

  const res = await fetch(`/upload/process?filename=${uploadedFileName}`);
  const data = await res.json();
  loadingSpinner.style.display = "none";

  if (res.ok) {
    statusDiv.textContent = "ğŸ‰ í•˜ì´ë¼ì´íŠ¸ ì˜ìƒ ìƒì„± ì™„ë£Œ!";
    const finalVideo = document.getElementById("finalVideo");
    finalVideo.src = "/results/highlight_sample.mp4?" + new Date().getTime();
    finalVideo.style.display = "block";
  } else {
    statusDiv.textContent = "âŒ í•˜ì´ë¼ì´íŠ¸ ìƒì„± ì‹¤íŒ¨";
    startBtn.disabled = false;
  }
});
</script>

</body>
</html>
